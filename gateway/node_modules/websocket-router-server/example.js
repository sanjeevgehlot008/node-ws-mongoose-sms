var WebsocketRouter = require("websocket-router-server");

var wr = new WebsocketRouter();

var router = wr.router;

router.post("message", function(socket, request, response) {
	response
		.tellAll() // Adds all sockets as receivers (default receiver is only sending socket)
		.respond(request.data); // responds with same type and route as message came from
});

function printConnectionCount(server) {
	console.log("Connection count: "+server.sockets.length);
}

wr.on("connect", function(socket) {
	printConnectionCount(wr);
});
wr.on("disconnect", function(code, reason) {
	printConnectionCount(wr);
});
wr.createServer();